<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1>Mon Espace</h1>
            @if (employee()) {
            <p class="welcome-text">Bonjour, {{ employee()!.prenom }} {{ employee()!.nom }}</p>
            }
        </div>
        <div class="header-actions">
            <button class="btn-icon" title="Notifications">
                <span class="notification-badge" *ngIf="getUnreadCount() > 0">{{ getUnreadCount() }}</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
            </button>
            <div class="user-profile-mini" *ngIf="employee()">
                <div class="avatar-mini">{{ employee()!.prenom[0] }}{{ employee()!.nom[0] }}</div>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement de votre espace...</p>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-state">
        <p>{{ error() }}</p>
        <button class="btn-primary" (click)="loadDashboardData()">Réessayer</button>
    </div>
    }

    <!-- Dashboard Content -->
    @if (!loading() && !error()) {
    <div class="dashboard-content">
        <!-- KPI Cards -->
        <section class="kpi-section">
            <div class="section-header">
                <h2>Vue d'ensemble</h2>
                <span class="date-text">Aujourd'hui, {{ today | date:'dd MMMM yyyy' : '' : 'fr-FR' }}</span>
            </div>
            <div class="kpi-grid">
                @if (kpis()) {
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                    </div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.niveauGlobalCompetences }}%</h3>
                        <p>Niveau global</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(34, 197, 94, 0.1); color: #22c55e;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.competencesValidees }}</h3>
                        <p>Compétences validées</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    </div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.formationsEnCours }}</h3>
                        <p>Formations en cours</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    </div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.projetsActifs }}</h3>
                        <p>Projets actifs</p>
                    </div>
                </div>
                }
            </div>
        </section>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- À faire -->
            <section class="todo-section card">
                <div class="card-header">
                    <h2>À faire</h2>
                    <button class="btn-text">Voir tout</button>
                </div>
                @if (todos().length > 0) {
                <div class="todo-list">
                    @for (todo of todos(); track todo.id) {
                    <div class="todo-item">
                        <div class="todo-status" [style.background]="getPriorityColor(todo.priority)"></div>
                        <div class="todo-body">
                            <p class="todo-title">{{ todo.title }}</p>
                            <div class="todo-meta">
                                <span class="todo-type">{{ todo.type }}</span>
                                @if (todo.dueDate) {
                                <span class="todo-date">{{ todo.dueDate | date:'dd/MM/yyyy' }}</span>
                                }
                            </div>
                        </div>
                        <div class="todo-action">
                            <button class="btn-check">○</button>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <p class="empty-state">Aucune tâche en attente</p>
                }
            </section>

            <!-- Notifications -->
            <section class="notifications-section card">
                <div class="card-header">
                    <h2>Dernières activités</h2>
                    <a routerLink="/employee/notifications" class="btn-text">Tout voir</a>
                </div>
                @if (notifications().length > 0) {
                <div class="notifications-list">
                    @for (notification of notifications().slice(0, 5); track notification.id) {
                    <div class="notification-item" [class.unread]="!notification.read">
                        <div class="notification-icon" [style.background]="'rgba(16, 185, 129, 0.1)'">{{
                            getNotificationIcon(notification.type) }}</div>
                        <div class="notification-content">
                            <h4>{{ notification.title }}</h4>
                            <p>{{ notification.message }}</p>
                            <span class="notification-time">{{ getRelativeTime(notification.date) }}</span>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <p class="empty-state">Aucune notification récemment</p>
                }
            </section>
        </div>

        <!-- Quick Links Cards -->
        <section class="quick-links">
            <h2>Raccourcis</h2>
            <div class="links-grid">
                <a routerLink="/employee/profile" class="quick-link-card">
                    <div class="link-icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </div>
                    <div class="link-info">
                        <h3>Profil</h3>
                        <p>Gérez vos infos</p>
                    </div>
                </a>
                <a routerLink="/employee/competencies" class="quick-link-card">
                    <div class="link-icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                    </div>
                    <div class="link-info">
                        <h3>Compétences</h3>
                        <p>Suivez vos acquis</p>
                    </div>
                </a>
                <a routerLink="/employee/tests" class="quick-link-card">
                    <div class="link-icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                    </div>
                    <div class="link-info">
                        <h3>Tests</h3>
                        <p>Validez vos skills</p>
                    </div>
                </a>
                <a routerLink="/employee/formations" class="quick-link-card">
                    <div class="link-icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>
                    </div>
                    <div class="link-info">
                        <h3>Formations</h3>
                        <p>Apprenez plus</p>
                    </div>
                </a>
            </div>
        </section>
    </div>
    }
</div>