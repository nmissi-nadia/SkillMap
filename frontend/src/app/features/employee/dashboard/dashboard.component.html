<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1>Mon Espace</h1>
            @if (employee()) {
            <p class="welcome-text">Bonjour, {{ employee()!.prenom }} {{ employee()!.nom }}</p>
            }
        </div>
        <div class="header-actions">
            <button class="btn-icon" title="Notifications">
                <span class="notification-badge">{{ getUnreadCount() }}</span>
                üîî
            </button>
            <button class="btn-logout" (click)="logout()">
                D√©connexion
            </button>
        </div>
    </header>

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement de votre espace...</p>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-state">
        <p>{{ error() }}</p>
        <button class="btn-primary" (click)="loadDashboardData()">R√©essayer</button>
    </div>
    }

    <!-- Dashboard Content -->
    @if (!loading() && !error()) {
    <div class="dashboard-content">
        <!-- KPI Cards -->
        <section class="kpi-section">
            <h2>Vue d'ensemble</h2>
            <div class="kpi-grid">
                @if (kpis()) {
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: var(--accent);">üìä</div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.niveauGlobalCompetences }}%</h3>
                        <p>Niveau global</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: var(--success);">‚úì</div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.competencesValidees }}</h3>
                        <p>Comp√©tences valid√©es</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: var(--info);">üìö</div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.formationsEnCours }}</h3>
                        <p>Formations en cours</p>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-icon" style="background: var(--primary);">üìã</div>
                    <div class="kpi-content">
                        <h3>{{ kpis()!.projetsActifs }}</h3>
                        <p>Projets actifs</p>
                    </div>
                </div>
                }
            </div>
        </section>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- √Ä faire -->
            <section class="todo-section card">
                <h2>√Ä faire</h2>
                @if (todos().length > 0) {
                <div class="todo-list">
                    @for (todo of todos(); track todo.id) {
                    <div class="todo-item">
                        <div class="todo-header">
                            <span class="todo-type" [style.color]="getPriorityColor(todo.priority)">
                                {{ todo.type }}
                            </span>
                            @if (todo.dueDate) {
                            <span class="todo-date">{{ todo.dueDate | date:'dd/MM/yyyy' }}</span>
                            }
                        </div>
                        <p class="todo-title">{{ todo.title }}</p>
                        <div class="todo-footer">
                            <span class="priority-badge" [style.background]="getPriorityColor(todo.priority)">
                                {{ todo.priority === 'HIGH' ? 'Urgent' : todo.priority === 'MEDIUM' ? 'Moyen' : 'Faible'
                                }}
                            </span>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <p class="empty-state">Aucune t√¢che en attente üéâ</p>
                }
            </section>

            <!-- Notifications -->
            <section class="notifications-section card">
                <h2>Notifications</h2>
                @if (notifications().length > 0) {
                <div class="notifications-list">
                    @for (notification of notifications().slice(0, 5); track notification.id) {
                    <div class="notification-item" [class.unread]="!notification.read">
                        <div class="notification-icon">{{ getNotificationIcon(notification.type) }}</div>
                        <div class="notification-content">
                            <h4>{{ notification.title }}</h4>
                            <p>{{ notification.message }}</p>
                            <span class="notification-time">{{ getRelativeTime(notification.date) }}</span>
                        </div>
                    </div>
                    }
                </div>
                <a routerLink="/employee/notifications" class="view-all-link">Voir toutes les notifications ‚Üí</a>
                } @else {
                <p class="empty-state">Aucune notification</p>
                }
            </section>
        </div>

        <!-- Quick Links -->
        <section class="quick-links">
            <h2>Acc√®s rapide</h2>
            <div class="links-grid">
                <a routerLink="/employee/profile" class="quick-link-card">
                    <span class="link-icon">üë§</span>
                    <span class="link-title">Mon Profil</span>
                </a>
                <a routerLink="/employee/competencies" class="quick-link-card">
                    <span class="link-icon">üéØ</span>
                    <span class="link-title">Mes Comp√©tences</span>
                </a>
                <a routerLink="/employee/tests" class="quick-link-card">
                    <span class="link-icon">üìù</span>
                    <span class="link-title">Tests Techniques</span>
                </a>
                <a routerLink="/employee/formations" class="quick-link-card">
                    <span class="link-icon">üìö</span>
                    <span class="link-title">Formations</span>
                </a>
                <a routerLink="/employee/messaging" class="quick-link-card">
                    <span class="link-icon">üí¨</span>
                    <span class="link-title">Messagerie</span>
                </a>
            </div>
        </section>
    </div>
    }
</div>