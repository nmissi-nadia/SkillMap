<div class="tests-container">
    <div class="page-header">
        <div class="header-content">
            <h1>Mes Tests Techniques</h1>
            <p>Consultez et passez vos tests assignés</p>
        </div>
        <a routerLink="/employee/dashboard" class="btn-back">← Retour au dashboard</a>
    </div>

    @if (errorMessage()) {
    <div class="alert alert-error">
        <span>! {{ errorMessage() }}</span>
        <button (click)="errorMessage.set(null)">X</button>
    </div>
    }

    <!-- Filters -->
    <div class="filters">
        <button class="filter-btn" [class.active]="selectedFilter() === 'all'" (click)="selectedFilter.set('all')">
            Tous
        </button>
        <button class="filter-btn" [class.active]="selectedFilter() === 'assigned'"
            (click)="selectedFilter.set('assigned')">
            À faire
        </button>
        <button class="filter-btn" [class.active]="selectedFilter() === 'in_progress'"
            (click)="selectedFilter.set('in_progress')">
            En cours
        </button>
        <button class="filter-btn" [class.active]="selectedFilter() === 'completed'"
            (click)="selectedFilter.set('completed')">
            Terminés
        </button>
    </div>

    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement de vos tests...</p>
    </div>
    } @else {
    @if (filteredTests.length === 0) {
    <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
                d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" />
            <path d="M14 2V8H20" />
        </svg>
        <h3>Aucun test trouvé</h3>
        <p>Vous n'avez pas de tests dans cette catégorie</p>
    </div>
    } @else {
    <div class="tests-grid">
        @for (assignment of filteredTests; track assignment.id) {
        <div class="test-card" [class.overdue]="isOverdue(assignment.dateLimite, assignment.statut)">
            <div class="test-header">
                <div class="test-title-section">
                    <h3>{{ assignment.test.titre }}</h3>
                    <div class="test-badges">
                        <span [class]="'badge ' + getStatutClass(assignment.statut)">
                            {{ getStatutLabel(assignment.statut) }}
                        </span>
                        <span [class]="'badge ' + getDifficulteClass(assignment.test.difficulte)">
                            {{ getDifficulteLabel(assignment.test.difficulte) }}
                        </span>
                    </div>
                </div>
                @if (assignment.score !== undefined) {
                <div class="test-score">
                    <div class="score-circle" [class.high-score]="assignment.score >= 80"
                        [class.medium-score]="assignment.score >= 60 && assignment.score < 80">
                        <span class="score-value">{{ assignment.score }}</span>
                        <span class="score-label">%</span>
                    </div>
                </div>
                }
            </div>

            <p class="test-description">{{ assignment.test.description }}</p>

            <div class="test-meta">
                <div class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6V12L16 14" />
                    </svg>
                    <span>{{ assignment.test.duree }} min</span>
                </div>
                <div class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <path d="M16 2V6" />
                        <path d="M8 2V6" />
                        <path d="M3 10H21" />
                    </svg>
                    <span>
                        @if (isOverdue(assignment.dateLimite, assignment.statut)) {
                        <strong class="overdue-text">Expiré</strong>
                        } @else if (getDaysRemaining(assignment.dateLimite) === 0) {
                        <strong class="urgent-text">Aujourd'hui</strong>
                        } @else if (getDaysRemaining(assignment.dateLimite) === 1) {
                        <strong class="urgent-text">Demain</strong>
                        } @else {
                        Dans {{ getDaysRemaining(assignment.dateLimite) }} jours
                        }
                    </span>
                </div>
            </div>

            <div class="test-competences">
                @for (comp of assignment.test.competences; track comp) {
                <span class="competence-tag">{{ comp }}</span>
                }
            </div>

            <div class="test-actions">
                @if (assignment.statut === 'ASSIGNE') {
                <button class="btn btn-primary" (click)="startTest(assignment)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3" />
                    </svg>
                    Commencer le test
                </button>
                } @else if (assignment.statut === 'EN_COURS') {
                <button class="btn btn-warning" (click)="continueTest(assignment)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3" />
                    </svg>
                    Continuer le test
                </button>
                } @else {
                <button class="btn btn-secondary" (click)="viewResults(assignment)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12S5 4 12 4s11 8 11 8-4 8-11 8S1 12 1 12z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    Voir les résultats
                </button>
                }
            </div>
        </div>
        }
    </div>
    }
    }
</div>