<div class="formations-page">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1 class="title">
                Gestion des Formations
            </h1>
            <p class="subtitle">Suivi et administration des programmes de formation</p>
        </div>
        <div class="header-actions">
            <a routerLink="/rh/dashboard" class="back-btn">← Retour</a>
            <button class="create-btn">+ Nouvelle Formation</button>
        </div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Chargement des formations...</p>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-banner">
        <span class="error-icon">!</span>
        <p>{{ error() }}</p>
    </div>
    }

    <!-- Formations List -->
    @if (!isLoading() && !error()) {
    <div class="formations-stats">
        <div class="stat-item">
            <span class="stat-label">Total formations</span>
            <span class="stat-value">{{ totalElements() }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Page actuelle</span>
            <span class="stat-value">{{ currentPage() + 1 }} / {{ totalPages() }}</span>
        </div>
    </div>

    <div class="formations-grid">
        @for (formation of formations(); track formation.id) {
        <div class="formation-card">
            <div class="formation-header">
                <h3 class="formation-title">{{ formation.titre }}</h3>
                <span class="statut-badge" [style.background-color]="getStatutColor(formation.statut)">
                    {{ getStatutLabel(formation.statut) }}
                </span>
            </div>

            <div class="formation-body">
                <div class="formation-info">
                    <div class="info-item">
                        <span class="info-icon">Org:</span>
                        <span class="info-text">{{ formation.organisme }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">Type:</span>
                        <span class="info-text">{{ formation.type }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-icon">Début:</span>
                        <span class="info-text">{{ formatDate(formation.dateDebut) }}</span>
                    </div>
                    @if (formation.dateFin) {
                    <div class="info-item">
                        <span class="info-icon">Fin:</span>
                        <span class="info-text">{{ formatDate(formation.dateFin) }}</span>
                    </div>
                    }
                    <div class="info-item">
                        <span class="info-icon">Emp:</span>
                        <span class="info-text">{{ formation.employeIds.length }} employé(s)</span>
                    </div>
                </div>
            </div>

            <div class="formation-actions">
                <button class="btn-view" (click)="viewBudgetDetails(formation)">
                    Budget
                </button>
                <button class="btn-edit">Modifier</button>
                <button class="btn-assign">Assigner</button>
            </div>
        </div>
        } @empty {
        <div class="empty-state">
            <span class="empty-icon">-</span>
            <h3>Aucune formation trouvée</h3>
            <p>Commencez par créer votre première formation</p>
            <button class="create-btn">+ Créer une formation</button>
        </div>
        }
    </div>

    <!-- Pagination -->
    @if (totalPages() > 1) {
    <div class="pagination">
        <button class="page-btn" (click)="previousPage()" [disabled]="currentPage() === 0">
            ← Précédent
        </button>

        <div class="page-numbers">
            @for (page of getPageNumbers(); track page) {
            <button class="page-number" [class.active]="page === currentPage()" (click)="goToPage(page)">
                {{ page + 1 }}
            </button>
            }
        </div>

        <button class="page-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages() - 1">
            Suivant →
        </button>
    </div>
    }
    }

    <!-- Budget Modal -->
    @if (showBudgetModal()) {
    <div class="modal-overlay" (click)="closeBudgetModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Détails du Budget</h2>
                <button class="close-btn" (click)="closeBudgetModal()">X</button>
            </div>

            @if (isLoadingBudget()) {
            <div class="modal-loading">
                <div class="spinner"></div>
                <p>Chargement des détails...</p>
            </div>
            } @else if (formationBudget()) {
            <div class="modal-body">
                <h3>{{ formationBudget()!.titre }}</h3>

                <div class="budget-stats-grid">
                    <div class="budget-stat">
                        <span class="budget-label">Coût total</span>
                        <span class="budget-value">
                            {{ formationBudget()!.coutTotal ? formationBudget()!.coutTotal + ' €' : 'N/A' }}
                        </span>
                    </div>
                    <div class="budget-stat">
                        <span class="budget-label">Coût par employé</span>
                        <span class="budget-value">
                            {{ formationBudget()!.coutParEmploye ? formationBudget()!.coutParEmploye + ' €' : 'N/A' }}
                        </span>
                    </div>
                    <div class="budget-stat">
                        <span class="budget-label">Employés assignés</span>
                        <span class="budget-value">{{ formationBudget()!.nombreEmployesAssignes }}</span>
                    </div>
                    <div class="budget-stat">
                        <span class="budget-label">Terminés</span>
                        <span class="budget-value success">{{ formationBudget()!.nombreEmployesTermines }}</span>
                    </div>
                    <div class="budget-stat">
                        <span class="budget-label">En cours</span>
                        <span class="budget-value warning">{{ formationBudget()!.nombreEmployesEnCours }}</span>
                    </div>
                    <div class="budget-stat">
                        <span class="budget-label">Taux de complétion</span>
                        <span class="budget-value">{{ formationBudget()!.tauxCompletion.toFixed(1) }}%</span>
                    </div>
                </div>

                <div class="progress-section">
                    <h4>Progression globale</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="formationBudget()!.tauxCompletion"></div>
                    </div>
                </div>

                <div class="employees-section">
                    <h4>Statuts des employés</h4>
                    <div class="employees-list">
                        @for (employe of formationBudget()!.employesStatuts; track employe.employeId) {
                        <div class="employee-item">
                            <div class="employee-info">
                                <span class="employee-name">
                                    {{ employe.employeNom }} {{ employe.employePrenom }}
                                </span>
                                <span class="employee-statut">{{ employe.statut }}</span>
                            </div>
                            <div class="employee-progress">
                                <div class="progress-bar small">
                                    <div class="progress-fill" [style.width.%]="employe.progression"></div>
                                </div>
                                <span class="progress-text">{{ employe.progression }}%</span>
                            </div>
                            @if (employe.certification) {
                            <div class="certification-badge">
                                <span class="cert-icon">Cert:</span>
                                <span>{{ employe.certification }}</span>
                            </div>
                            }
                        </div>
                        }
                    </div>
                </div>
            </div>
            }
        </div>
    </div>
    }
</div>